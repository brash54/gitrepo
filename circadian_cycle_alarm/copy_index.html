<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">

    <title>Circadian Cycle Alarm</title>
    <link href="css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="css/flipclock.css">
    <link rel="stylesheet" href="jquery-ui-1.12.1.custom/jquery-ui.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="js/library_api.js"></script>
    <script src="js/flipclock/flipclock.min.js"></script>

    <script>
        $(document).ready(function() {
            var clock = $('.clock').FlipClock({
                clockFace: 'TwelveHourClock'
            });

            $("#datepicker").datepicker({
                minDate: new Date(),
                maxDate: 30
            });

            $("#datepicker").prop('readonly', true);

             

            $("#set_alarm").click(function() {
                $("span").text("");


                var zipcode = $("#zip_code").val();
                
            if (gmURL.isValid(zipcode)) {
             var locURL = gmURL.getlatlngURL(zipcode);
            }
        else { $("#zip_code").next().text("Please enter a valid zip code.")
    }
    alert(locURL);
    var latlng = apiGM.getlatlng(locURL);

    alert(latlng);

                var alarmDate = new Date;
                alarmDate = $("#datepicker").val();

                var alarmYear = alarmDate.substring(6);

                var alarmDay = alarmDate.substring(3, 5);

                var alarmMonth = alarmDate.substring(0, 2);
                console.log(alarmMonth);

                var apiDate = alarmYear + "-" + alarmMonth + "-" + alarmDay;
                console.log(apiDate);

                var locUrl1 = "https://maps.googleapis.com/maps/api/geocode/json?address=";
                var locUrl2 = "&key=AIzaSyBBRAiapQxnydUukcB3NA296Mu6UNLICC8";
                var locUrl = locUrl1 + zipCode + locUrl2;


                $.getJSON(locUrl, function(data1) {


                    $("#locdata").append(
                        "Your latitude is: " + data1.results[0].geometry.location.lat + "<br>" +
                        "Your longitude is: " + data1.results[0].geometry.location.lng + "<br>"
                    );
                    latLng = "lat=" + data1.results[0].geometry.location.lat + "&lng=" + data1.results[0].geometry.location.lng;
                    var sunUrl1 = "https://api.sunrise-sunset.org/json?";

                    var sunUrl = sunUrl1 + latLng + "&date=" + apiDate;

                    $.getJSON(sunUrl, function(data) {



                        var utcSunrise = alarmDate + " " + data.results.sunrise + " UTC";

                        var localSunrise = new Date("'" + utcSunrise + "'");

                        var utcSunset = alarmDate + " " + data.results.sunset + " UTC";

                        var utcSunset = utcSunset.replace("AM", "PM");
                        var localSunset = new Date("'" + utcSunset + "'");

                        $("#sundata").append(
                            "sunrise: " + localSunrise + "<br>" +
                            "sunset: " + localSunset + "<br>"
                        );


                        setInterval(function() {
                            var nowTime = new Date();
                            var nowTime = nowTime.getHours() + ":" + nowTime.getMinutes();
                            var alarmTime = new Date();

                            /* localSunrise is 12 hour clock while alarmTime is 24 hour clock. Will be equal once per day
                            Testing can be carried out by setting local time on PC to a few minutes before a sunrise time. Time should be AM. */
                            var alarmTime = localSunrise.getHours() + ":" + localSunrise.getMinutes();
                            if (nowTime == alarmTime) {
                                // alert(nowTime); 
                                $("#siren").trigger('play');
                            }

                        }, 500);
                    }); //getjason
                }); //getjason
            }); //setAlarm



        }); //end ready

       
    </script>
</head>

<body>
    <header class="clock">
        <div></div>
    </header>


    <main>

        <label>Enter Your Zip Code:</label>
        <input type="text" id="zip_code" placeholder="#####">
        <span>&nbsp;</span><br>
        <label>Choose Alarm Date:</label>
        <input type="text" id="datepicker" placeholder="MM/DD/YYYY"> <br>
        <Label>&nbsp;</Label>
        <input type="button" id="set_alarm" value="Set Alarm"><br>
      
      
    
        <div id="locdata"></div>
        <div id="sundata"></div>


        <audio id="siren" controls="controls">
            <source src="sound/siren_noise.mp3" type="audio/mpeg">
          </audio>

    </main>

    <footer></footer>
</body>

</html>
